datatype Date
datatype String
datatype int
datatype Real
datatype Blob
datatype natural_language


customdatatype jpeg {
	elements{
		 	date : Date ['it.univaq.disim.Date'],
		 	thumbnail : Blob ['it.univaq.disim.Blob']
	}
}


entity Review{
	genericList "DocumentDatabase.ReviewsDB"
	id : String
	product -> Product[1]
	identifer (id)
}

entity Product{
	genericList "RelationalDatabase.ProductDB"
	id : String
	name : String
	description : String
		
	review :-> Review."Review.product"[0..*]
	orders -> Product[0..*]
	identifer (name)
}

entity Order{
	genericList "RelationalDatabase.OrderDB"
	id : String
	date : Date
	totalAmount : int
	
	products -> Product.products[0..*]
	users -> User."User.orders"[1]
	paidWith -> CreditCard[1]
	identifer (id)
}

entity User{
	genericList "RelationalDatabase.UserDB"
	id : String
	name : String
	
	comments :-> Comment[0..*]
	paymentsDetails :-> CreditCard[0..*]
	orders -> Order[0..*]
	identifer (name)
}

entity Comment{
	genericList "DocumentDatabase.CommentsDB"
	id : String
	content : String
	
	responses :-> Comment[0..*]
	identifer (id)
}

entity CreditCard{
	genericList "RelationalDatabase.CreditCardDB"
	id : String
	number : String
	expiryDate : Date
	identifer (id)
}



relationaldb RelationalDatabase{
	tables{
		table {
			OrderDB : Order
			index orderIndex {
				attributes ("Order.date")
			}
			idSpec ("Order.date")
		}
		table {
			UserDB : User
			index  userIndex{
				attributes ('User.name')
//				references ("User.comments")
				}
			idSpec ('User.name')
		}
		table {
			ProductDB : Product
			index productIndex{
				attributes ('Product.name')
			}
			idSpec ('Product.name')
		}
		table {
			CreditCardDB : CreditCard
			index creditCardIndex{
				attributes ("CreditCard.number")
			}
			idSpec ("CreditCard.number")
		}
	}
}

documentdb DocumentDatabase{
	collections{
			ReviewsDB : Review
			CommentsDB : Comment
	}
}



